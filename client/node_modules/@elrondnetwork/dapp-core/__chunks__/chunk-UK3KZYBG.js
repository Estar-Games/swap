import{a as h}from"./chunk-EXNBNIH3.js";import{a as G}from"./chunk-7JG4YRLS.js";import{c as E,d}from"./chunk-5WWDE5CH.js";import{b as x}from"./chunk-CIYEPAMQ.js";import{c as D}from"./chunk-7VRNE5H2.js";import{c as b,d as A}from"./chunk-W6LR3W2N.js";import{c as L,e as B,f as P}from"./chunk-EU6LW3Z6.js";import{a as R}from"./chunk-6O6BU23Y.js";import{b as H}from"./chunk-7YJZIEAA.js";import{a as M}from"./chunk-N5CEAHUR.js";import{e as s,g as S}from"./chunk-YMWLFVZR.js";S();import{useEffect as Q,useRef as V,useState as $}from"react";import{WalletConnectProvider as X}from"@elrondnetwork/erdjs-wallet-connect-provider";var Y=({callbackRoute:w,logoutRoute:v,token:l,redirectAfterLogin:O=!1})=>{let a=E(),z=15e3,[y,F]=$(""),[u,T]=$(""),{provider:g}=G(),p=d(b),J=d(A),I=d(D),n=V(g),m,W=Boolean(u),N=!W,j=W?`${J}?wallet-connect=${encodeURIComponent(u)}`:null;Q(()=>{k();let e=setInterval(()=>{k()},z);return()=>clearInterval(e)},[g]),h(()=>{U()},[l]),h(()=>{n.current=g},[g]);let f=()=>{x(v)};function k(){return s(this,null,function*(){var o,t;if(!Boolean((t=(o=n.current)==null?void 0:o.walletConnector)==null?void 0:t.connected))return;let i={method:"heartbeat",params:{}};try{yield n.current.sendCustomMessage(i)}catch(r){console.error("Connection lost",r),f()}})}function q(){return s(this,null,function*(){try{let e=n.current;if(I||e==null)return;let i=yield e.getAddress(),o=yield e.getSignature(),t=Boolean(o),r={address:i,loginMethod:"walletconnect"},c={logoutRoute:v,loginType:"walletConnect",callbackRoute:w};t?(a(L(c)),a(P(o))):a(L(c)),a(H(r)),e.walletConnector.on("heartbeat",()=>{clearInterval(m),m=setInterval(()=>{console.log("Maiar Wallet Connection Lost"),f(),clearInterval(m)},15e4)}),R(w,O)}catch(e){F("Invalid address"),console.error(e)}})}function K(e=!0){return s(this,null,function*(){var r,c;let i=e&&!u;if(!p||((c=(r=n==null?void 0:n.current)==null?void 0:r.isInitialized)==null?void 0:c.call(r))&&!i)return;let o={onClientLogin:q,onClientLogout:f},t=new X(p,o);yield t.init(),M(t),n.current=t,e&&U()})}function U(){return s(this,null,function*(){var t;if(!p)return;let e=yield(t=n.current)==null?void 0:t.login();if(!Boolean(e))return;if(!l){T(e);return}let o=`${e}&token=${l}`;T(o),a(B({loginToken:l}))})}let C=Boolean(y);return[K,{error:y,loginFailed:C,isLoading:N&&!C,isLoggedIn:I&&!C},{uriDeepLink:j,walletConnectUri:u}]},me=Y;export{Y as a,me as b};
//# sourceMappingURL=chunk-UK3KZYBG.js.map
