import{c as j,d as h}from"./chunk-5WWDE5CH.js";import{c as N}from"./chunk-7VRNE5H2.js";import{g as w,h as V}from"./chunk-RVI5KZYP.js";import{d as B,e as O}from"./chunk-EU6LW3Z6.js";import{a as l}from"./chunk-CQECN6DM.js";import{a as S}from"./chunk-6O6BU23Y.js";import{b as y}from"./chunk-7YJZIEAA.js";import{g as W}from"./chunk-AXKBBYAP.js";import{a as x}from"./chunk-N5CEAHUR.js";import{d as $}from"./chunk-MDPKQI3Z.js";import{a as M,b as F,e as c,f as U,g as R}from"./chunk-YMWLFVZR.js";R();import{useEffect as se,useState as s}from"react";import{HWProvider as T}from"@elrondnetwork/erdjs-hw-provider";var d="Could not initialise ledger app, make sure Elrond app is open",ie=10;function we({callbackRoute:P,token:u,addressesPerPage:q=ie,redirectAfterLogin:v=!1}){let E=h(W),J=h(N),i=j(),[I,a]=s(""),[K,o]=s(!1),f=new T,[p,b]=s(0),[g,Q]=s([]),[k,X]=s(""),[C,Y]=s(!1),[r,L]=s(null),[Z,m]=s(!1);function H({provider:e,address:n,index:t,signature:G}){x(e),i(B({index:t,loginType:"ledger"})),G&&i(O({loginToken:String(u),signature:G})),i(y({address:n,loginMethod:"ledger"})),S(P,v)}let z=(e,n)=>{let{errorMessage:t}=l(e);t&&a(t+n),o(!1),console.warn(e),i(w(null))};function _(e){return c(this,null,function*(){if(r==null)return!1;let{index:n}=r;if(u)try{let t=yield e.tokenLogin({token:U.Buffer.from(`${u}{}`),addressIndex:n});H({address:t.address,provider:e,index:n,signature:t.signature.hex()})}catch(t){z(t,". Update Elrond App to continue.")}else try{let t=yield e.login({addressIndex:n});H({address:t,provider:e,index:n})}catch(t){return z(t),!1}return!0})}function ee(){return c(this,null,function*(){try{if(o(!0),r==null)return!1;i(E?V(r):w(F(M({},r),{version:k,hasContractDataEnabled:C})));let e=new T;if(!(yield e.init()))return a(d),console.warn(d),!1;o(!1),yield _(e)}catch(e){let{errorMessage:n}=l(e);n&&a(n),console.warn(d,e)}finally{o(!1)}return m(!1),!0})}function D(){return c(this,null,function*(){try{if(o(!0),!(yield f.init())){a(d),console.warn(d),o(!1);return}let n=yield f.getAccounts(p,q),t=yield $(f);X(t.version),Y(t.dataEnabled),Q(n),o(!1)}catch(e){let{errorMessage:n,defaultErrorMessage:t}=l(e);a(n!=null?n:t),console.error("error",e),o(!1)}})}function ne(){return c(this,null,function*(){a("");try{if(o(!0),E!=null){let e=new T;if(!(yield e.init())||!r){console.warn(d);return}let t=yield e.login({addressIndex:r.index.valueOf()});x(e),i(y({address:t,loginMethod:"ledger"})),S(P,v)}else(g==null?void 0:g.length)>0||(yield D()),m(!0)}catch(e){console.error("error ",e);let{defaultErrorMessage:n}=l();a(n)}finally{o(!1)}})}function te(e){L(e)}function oe(){L(null),b(e=>e+1)}function re(){L(null),b(e=>e===0?0:e-1)}se(()=>{D()},[p]);let A=Boolean(I);return[ne,{loginFailed:A,isLoggedIn:J&&!A,error:I,isLoading:K&&!A},{accounts:g,showAddressList:Z,startIndex:p,selectedAddress:r,version:k,contractDataEnabled:C,onGoToPrevPage:re,onGoToNextPage:oe,onSelectAddress:te,onConfirmSelectedAddress:ee}]}export{we as a};
//# sourceMappingURL=chunk-C4BVYZ2C.js.map
