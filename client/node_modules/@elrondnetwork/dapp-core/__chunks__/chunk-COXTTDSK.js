import{a as B}from"./chunk-LTUYRPJ2.js";import{a as V}from"./chunk-7JG4YRLS.js";import{c as z,d as I}from"./chunk-5WWDE5CH.js";import{M as j,p as L,r as D}from"./chunk-CIYEPAMQ.js";import{a as x}from"./chunk-SORSKVNN.js";import{a as U}from"./chunk-5MX63NMQ.js";import{h as G}from"./chunk-2BJAJJPS.js";import{e as O,j as m}from"./chunk-TRR6AJCY.js";import{b as M}from"./chunk-FVNTWDXO.js";import{b as w}from"./chunk-AXKBBYAP.js";import{b as W}from"./chunk-MDPKQI3Z.js";import{j as k}from"./chunk-OZ6SMI6T.js";import{a as y,b as P,c as v,d as C,e as _}from"./chunk-SWLQGVF6.js";import{e as p,g as N}from"./chunk-YMWLFVZR.js";N();import{useEffect as Q,useRef as Y,useState as nn}from"react";import{ExtensionProvider as $}from"@elrondnetwork/erdjs-extension-provider";var tn=(i,d)=>d.map((g,a)=>(g.setNonce(i+a),g)),sn=()=>{let i=z(),d=Y("/"),g=I(w),{provider:a}=V(),h=W(a),[F,E]=nn(null),o=I(j),X=Boolean(o==null?void 0:o.transactions),A=n=>{E(null),R(n)};B(A);function R(n){var r,s;let e=a instanceof $;i(O()),i(G(n)),e&&((s=(r=$.getInstance())==null?void 0:r.cancelAction)==null||s.call(r))}let f=(n,e)=>{let r=n!==P;R(e),r&&E(n)},Z=(n,e,r="")=>{let s={[k]:e},l=`${window.location.origin}${r}`,c=U({callbackUrl:l,urlParams:s});a.signTransactions(n,{callbackUrl:encodeURIComponent(c)})},q=()=>p(void 0,null,function*(){var b;let{sessionId:n,transactions:e,callbackRoute:r,customTransactionInformation:s}=o,{redirectAfterSign:l}=s,c=r||window.location.pathname,T=window.location.pathname.includes(c),S=l&&!T;try{if(!(yield(b=a==null?void 0:a.init)==null?void 0:b.call(a)))return}catch(t){let u=(t==null?void 0:t.message)||t||C;f(u);return}try{let t=yield a.signTransactions(e),u=Object.keys(t).length===e.length;if(!(t&&(t&&u)))return;let J=Object.values(t).map(K=>x(K));i(m({sessionId:n,transactions:J,status:"signed"})),S&&M(c)}catch(t){let u=(t==null?void 0:t.message)||t||v;i(m({sessionId:n,status:"cancelled"})),f(u,n)}}),H=()=>p(void 0,null,function*(){if(!o)return;let{sessionId:n,transactions:e,callbackRoute:r}=o;if(!a){console.error(_);return}d.current=r||window.location.pathname;try{let s=yield L(g);if(s==null)return;let l=h==="wallet",c=!["wallet","ledger"].includes(h),T=D(s),S=tn(T,e);l&&Z(S,n,r),c&&q()}catch(s){let c=(s==null?void 0:s.message)||y;f(c,n),i(m({sessionId:n,status:"cancelled"})),console.error(c,s)}});return Q(()=>{H()},[o]),{error:F,onAbort:A,hasTransactions:X,callbackRoute:d.current,sessionId:o==null?void 0:o.sessionId,transactions:o==null?void 0:o.transactions}},bn=sn;export{sn as a,bn as b};
//# sourceMappingURL=chunk-COXTTDSK.js.map
